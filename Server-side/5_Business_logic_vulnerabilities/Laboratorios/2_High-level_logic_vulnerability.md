# Lab: High-level logic vulnerability

This lab doesn't adequately validate user input. You can exploit a logic flaw in its purchasing workflow to buy items for an unintended price. To solve the lab, buy a "Lightweight l33t leather jacket".

You can log in to your own account using the following credentials: `wiener:peter`

![Practitioner](https://img.shields.io/badge/level-Apprentice-green)  

---

Iniciamos el laboratorio y tenemos una aplicación para hacer compras:
![image](https://github.com/user-attachments/assets/bd1c8c1c-44ea-497e-b431-feb5d61aaf68)

Accedemos al panel de login usando el botón `My account` e iniciamos sesión con nuestras credenciales:
![image](https://github.com/user-attachments/assets/84a9859b-2751-4922-aba7-beb0fe37b181)

En nuestro dashboard, vemos que tenemos disponibles $100 para hacer compras:
![image](https://github.com/user-attachments/assets/66342365-edac-4430-bcee-38bb4c9f8f82)

Hacemos click en `home` y vemos que la chaqueta tiene un precio más elevado que nuestro presupuesto:
![image](https://github.com/user-attachments/assets/1f059599-44dd-4cfd-9b68-09d91d570e8a)


Interceptamos con `Burp Suite` para analizar el flujo, primero hacemos click en `View details`:
![image](https://github.com/user-attachments/assets/e8e1610c-ad0e-453e-a183-9eba049dd3c0)
![image](https://github.com/user-attachments/assets/12a54f4e-55ff-4d74-a1a4-8730d78f6b99)

Luego añadimos al carrito:
![image](https://github.com/user-attachments/assets/f9db3926-9cea-44de-900c-36eafa183791)

Esta es una petición `POST` que tramita los parámetros `productId=1&redir=PRODUCT&quantity=1`, esto quiere decir que agregamos al carrito el `productId=1`, nos redirije a la página del producto (respuesta `302, Location: /product?productId=1`) y solicitamos la cantidad de 1 producto.

Luego hacemos click en el carrito para dirigirnos al dashboard `/cart`:
![image](https://github.com/user-attachments/assets/04b3d0cb-0815-4e2b-bd25-cf092abf3fc0)

Petición en `Burp Suite`:
![image](https://github.com/user-attachments/assets/572c1999-5b61-4013-bf34-82c6b8314f09)

Intentamos hacer la compra haciendo click en `Place order` y nos da el mensaje que no tenemos suficientes fondos:
![image](https://github.com/user-attachments/assets/657af2eb-d97f-498a-8297-a12a53edadf1)

![image](https://github.com/user-attachments/assets/0c380419-8bd9-47ee-9255-2091a64995b4)


Volvemos a nuestra solicitud `POST` que maneja parámetros, vamos a intentar modificar los valores para analizar la lógica.

Primero intentamos restar un producto al carrito:
![image](https://github.com/user-attachments/assets/d059c5fc-163e-47c4-8cf1-0848a4c3b81a)

Si accedemos al carrito, vemos que nos dice que está vacío:
![image](https://github.com/user-attachments/assets/0b221cbc-99c9-47b7-8ff5-ae48e09a397e)

Ahora vemos qué pasa si intentamos restar otro producto:
![image](https://github.com/user-attachments/assets/b5111a36-38fb-4901-a95e-8587ca954ed4)

Vemos que nos resta el producto en el carrito, es decir que nos acredita su valor:
![image](https://github.com/user-attachments/assets/7b719c51-ddeb-4257-8122-fd77f01edd4b)
















