# Lab: Exploiting path mapping for web cache deception

To solve the lab, find the API key for the user `carlos`. You can log in to your own account using the following credentials: `wiener:peter`.

![Practitioner](https://img.shields.io/badge/level-Apprentice-green) 

---

Iniciamos el laboratorio y nos encontramos con un blog:
![image](https://github.com/user-attachments/assets/7fdfb7ad-937e-492f-b438-1d1ada58f790)


Como sabemos que necesitamos identificar información sensible de un usuario, puntualmente la API key, procedemos a autenticarnos con nuestras credenciales `wiener:peter` accediendo al panel de autenticación en `My account`:
![image](https://github.com/user-attachments/assets/53bbc85d-49fc-4bc2-b054-7bcf82ff3481)

Nos logueamos exitosamente:
![image](https://github.com/user-attachments/assets/12686dfd-282d-4415-9f26-df2b3de5d331)


La autenticación exitosa nos redirije a `/my-account`, observamos que en el dashboard del usuario `carlos` se puede visualizar la API key:
![image](https://github.com/user-attachments/assets/e5c70a68-0ea7-4490-962f-457c049af451)

 Esto confirma que `/my-account` es un endpoint dinámico personalizado por usuario.

 Ahora nuestro objetivo es confirmar que el backend ignora segmentos adicionales y que el caché los interpreta como diferentes recursos.

 Enviamos la petición del endpoint `/my-account` al repeater y añadimos un segmento arbitrario adicional `/my-account/abc`:
![image](https://github.com/user-attachments/assets/4c53935d-107a-488e-92a3-ad9170d86fb9)
El backend ignora el segmento adicional /abc y la respuesta sigue incluyendo la API key de wiener, lo cual es fundamental para el ataque.

El siguiente paso sería confirmar que el caché almacena la respuesta si la URL tiene una extensión estática, como .js.

En el repeater modificamos la url a `/my-account/abc.js` y prestamos especial atención a los headers de respuesta:
![image](https://github.com/user-attachments/assets/9e6a6133-381b-4d56-8011-6ea0cdbd44e7)

Esto te indica que:

- El recurso no estaba en caché la primera vez (miss).

- Pero el caché está dispuesto a almacenarlo durante 30 segundos (Cache-Control: max-age=30).




