# Lab: SQL injection vulnerability allowing login bypass

This lab contains a SQL injection vulnerability in the login function.

To solve the lab, perform a SQL injection attack that logs in to the application as the `administrator` user.

![Practitioner](https://img.shields.io/badge/level-Apprentice-green)  


---

Accedemos al lab:
![image](https://github.com/user-attachments/assets/b59ca4cf-78fa-4fc6-8ed2-cb74cea8591a)

Ingresamos al panel de login haciendo click en `My account`:
![image](https://github.com/user-attachments/assets/a9810adb-fa9c-497a-9fec-e6452ae52f7e)

Comenzamos inyectando el caracter `'` para observar como reacciona la aplicaci√≥n y si lanza errores de sintaxis:
![image](https://github.com/user-attachments/assets/abf42a6e-7e4c-4ff4-934d-f0a29303d42a)

Como vemos, lanz√≥ un `Internal Server Error` lo que indica que la aplicaci√≥n podr√≠a ser vulnerable a SQLi:
![image](https://github.com/user-attachments/assets/7515ccfb-ebae-4a5a-8b69-5ca60e3a97a8)

Nosotros sabemos que la consulta podr√≠a ser la siguiente:
```sql
SELECT * FROM users WHERE username = [username] AND password = [password]
```

Procedemos a inyectar el siguiente payload: `administrator'--`

Por lo que la query quedar√≠a as√≠:
```sql
SELECT * FROM users WHERE username = 'administrator'--' AND password = [password]
```

Lo interesante de esto es que, si el usuario es correcto podremos hacer login exitosamente, de lo contrario no, por lo que incluso podr√≠amos realizar enumeraci√≥n de usuarios con capacidad de inicio de sesi√≥n.

Inyectamos el payload y resolvemos el lab:
![image](https://github.com/user-attachments/assets/efbe8952-c423-4052-b7d0-fc1f4270621b)
![image](https://github.com/user-attachments/assets/ae099723-c1f0-4a6d-96d3-e1dbbb0e3e54)


---

## ‚úÖ Conclusi√≥n

Se identific√≥ y explot√≥ exitosamente una vulnerabilidad de **inyecci√≥n SQL en la funcionalidad de login**, permitiendo eludir el control de autenticaci√≥n e iniciar sesi√≥n como el usuario `administrator`.

El payload `'--` trunc√≥ la parte restante de la consulta (`AND password = ...`), forzando la autenticaci√≥n sin necesidad de una contrase√±a v√°lida.

## üõ°Ô∏è Recomendaciones

- Utilizar consultas parametrizadas (prepared statements) que separen datos de instrucciones SQL.
- Evitar construir consultas SQL concatenando directamente entradas del usuario.
- Implementar mensajes de error gen√©ricos para evitar filtrado de errores de base de datos.
- Aplicar controles de tasa y bloqueo tras m√∫ltiples intentos fallidos para mitigar ataques de fuerza bruta o enumeraci√≥n de usuarios.

## üìö Lecciones aprendidas

- La inyecci√≥n `'--` es una t√©cnica cl√°sica que puede truncar consultas SQL y eludir verificaciones.
- Las respuestas diferentes al inyectar caracteres especiales pueden delatar vulnerabilidades.
- Este tipo de SQLi puede ser utilizado tanto para eludir autenticaci√≥n como para **enumerar usuarios v√°lidos**, si la aplicaci√≥n responde de manera distinta seg√∫n la existencia del usuario.

