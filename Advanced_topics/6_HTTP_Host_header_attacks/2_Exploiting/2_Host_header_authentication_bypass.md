# Lab: Host header authentication bypass

This lab makes an assumption about the privilege level of the user based on the HTTP Host header.

To solve the lab, access the admin panel and delete the user `carlos`.

![Practitioner](https://img.shields.io/badge/level-Apprentice-green) 

---

Iniciamos el laboratorio y nos encontramos con una aplicaci√≥n de compras online:
![image](https://github.com/user-attachments/assets/3d1b6377-7789-41f0-9038-74ada80d05f2)


Hacemos la prueba de cambiar la cabecera `Host` a un valor arbitrario:
![image](https://github.com/user-attachments/assets/9ef76f49-5721-4895-8521-c55e6f0dfe79)
Obtuvimos una respuesta `HTTP/2 200 OK` modificando el encabezado `Host` a `test`, lo cual sugiere que la aplicaci√≥n no valida correctamente este header.


Si accedemos al endpoint `/robots.txt` observamos el panel administrarivo en `/admin`:
![image](https://github.com/user-attachments/assets/85bd5be2-60aa-4900-b462-f69cd0fd35db)

Intentamos ingresar a `/admin`:
![image](https://github.com/user-attachments/assets/a197f785-8f6e-48c2-a31a-a76aa8b2ba34)


Enviamos esta request al Repeater y cambiamos el valor del header `Host: localhost` y obtenemos acceso al panel administrativo:
![image](https://github.com/user-attachments/assets/3b94b5e4-db11-4449-af08-2437299f9ac9)

Accedemos al endpoint `/admin/delete?username=carlos` para eliminar al usuario `carlos` y resolver el laboratorio:
![image](https://github.com/user-attachments/assets/3e38395d-6ac6-446d-909a-f02955f34548)

![image](https://github.com/user-attachments/assets/c1aa7348-f782-43a4-bc9d-38346842f770)


---

## ‚úÖ Conclusiones

* La aplicaci√≥n utiliza el valor del encabezado `Host` para inferir el **nivel de privilegio** del usuario.
* Este comportamiento permite **bypassear la autenticaci√≥n** simplemente manipulando el header, sin credenciales v√°lidas.
* Usamos `Host: localhost` para enga√±ar al servidor y obtener acceso a `/admin`.
* Aprovechamos este acceso para eliminar al usuario `carlos` y resolver el laboratorio.

---

## üõ°Ô∏è Recomendaciones

* **Nunca confiar en el valor del header `Host`** para decisiones de seguridad como control de acceso.
* Validar siempre que `Host` coincida con un conjunto expl√≠cito de dominios permitidos.
* Separar claramente los entornos de administraci√≥n y producci√≥n, usando autenticaci√≥n robusta.
* Evitar l√≥gica sensible basada en headers modificables por el cliente.

---

## üìö Lecciones aprendidas

* El encabezado `Host` **es controlable por el atacante** y no debe usarse como fuente de confianza.
* Muchas configuraciones por defecto en aplicaciones web **no restringen ni validan adecuadamente el header `Host`**.
* Una verificaci√≥n d√©bil o ausente en el `Host` puede habilitar ataques como:

  * Bypass de autenticaci√≥n
  * Password reset poisoning
  * Web cache poisoning
  * SSRF basados en routing
